<%# Question-specific fields partial %>
<%# This partial handles all fields for question steps, including answer type selection and variable name %>

<div class="field-container">
  <input type="text" 
         name="workflow[steps][][question]" 
         value="<%= step['question'] %>" 
         placeholder="Question text (type {{ to see available variables)" 
         class="w-full border rounded px-3 py-2"
         data-step-form-target="field"
         data-variable-autocomplete-target="input"
         data-required="true">
</div>

<div class="field-container" data-controller="question-form">
  <label class="block text-sm font-medium text-gray-700 mb-2">Answer Type</label>
  <div class="grid grid-cols-2 gap-2" data-question-form-target="answerTypeContainer">
    <% answer_types = [
      { value: 'text', label: 'Text' },
      { value: 'yes_no', label: 'Yes/No' },
      { value: 'multiple_choice', label: 'Multiple Choice' },
      { value: 'dropdown', label: 'Dropdown' },
      { value: 'date', label: 'Date' },
      { value: 'number', label: 'Number' },
      { value: 'file', label: 'File Upload' }
    ] %>
    
    <% answer_types.each do |answer_type| %>
      <label class="flex items-center gap-2 p-2 border rounded cursor-pointer hover:bg-gray-50 <%= 'bg-blue-50 border-blue-500' if step['answer_type'] == answer_type[:value] %>">
        <input type="radio" 
               name="workflow[steps][][answer_type]" 
               value="<%= answer_type[:value] %>"
               <%= 'checked' if step['answer_type'] == answer_type[:value] %>
               data-question-form-target="answerType"
               data-action="change->question-form#handleAnswerTypeChange"
               data-step-form-target="field"
               class="cursor-pointer">
        <span class="text-sm"><%= answer_type[:label] %></span>
      </label>
    <% end %>
  </div>
  
  <input type="hidden" name="workflow[steps][][answer_type]" value="<%= step['answer_type'] %>" data-question-form-target="hiddenAnswerType">
  
  <%# Options container for multiple_choice and dropdown - moved inside controller scope %>
  <div class="mt-4 <%= 'hidden' unless ['multiple_choice', 'dropdown'].include?(step['answer_type']) %>" 
       data-question-form-target="optionsContainer">
    <label class="block text-sm font-medium text-gray-700 mb-2">Options</label>
    <div data-question-form-target="optionsList" class="space-y-2">
      <% if step['options'].present? && step['options'].is_a?(Array) %>
        <% step['options'].each_with_index do |option, idx| %>
          <div class="flex gap-2 items-center option-item">
            <span class="drag-handle cursor-move text-gray-500 text-lg flex-shrink-0" title="Drag to reorder">â˜°</span>
            <input type="text" 
                   name="workflow[steps][][options][][label]" 
                   value="<%= option.is_a?(Hash) ? option['label'] : option %>"
                   placeholder="Option label" 
                   class="flex-1 border rounded px-2 py-1 text-sm min-w-0"
                   data-step-form-target="field">
            <input type="text" 
                   name="workflow[steps][][options][][value]" 
                   value="<%= option.is_a?(Hash) ? option['value'] : option %>"
                   placeholder="Option value" 
                   class="flex-1 border rounded px-2 py-1 text-sm min-w-0"
                   data-step-form-target="field">
            <button type="button" 
                    class="text-red-500 hover:text-red-700 text-sm px-2 flex-shrink-0"
                    data-action="click->question-form#removeOption">
              Remove
            </button>
          </div>
        <% end %>
      <% end %>
    </div>
    <button type="button" 
            class="mt-2 text-sm text-blue-600 hover:text-blue-800"
            data-action="click->question-form#addOption">
      + Add Option
    </button>
  </div>
</div>

<%# Variable name field - NO name attribute, synced to hidden field via JS %>
<div class="field-container">
  <label class="block text-sm font-medium text-gray-700 mb-1">Variable Name</label>
  <input type="text" 
         value="<%= step['variable_name'] %>" 
         placeholder="e.g., user_name, age, etc." 
         class="w-full border rounded px-3 py-2"
         data-step-form-target="field"
         data-question-form-target="variableName">
  <p class="mt-1 text-xs text-gray-500">Optional: Name this answer for use in decision steps</p>
</div>

